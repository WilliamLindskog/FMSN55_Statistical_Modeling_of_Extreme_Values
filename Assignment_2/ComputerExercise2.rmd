---
title: "2nd Computer Assignment"
author: "Tofig Mamedov & William Lindskog"
date: '2021-05-17'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

In this exercise English rainfall data will be analyzed from an extreme value point of view. 


## Analysis
You can also embed plots, for example:

```{r pressure, echo=FALSE}
library(in2extRemes)
in2extRemes()
```
# 1. Scatter Plot
```{r pressure, echo=FALSE}
names(rain)

```
# 2. Mean Residual Life Plot
The point is to select the lowest value $u$ in the linear region of the plot. This way, there will hopefully be enough samples to build a model.

Looking at the plot, there is linearity between $u=30$ and $u=60$. However, to selecting $u=30$ as the threshold is better since there are only 6 excesses for $u=60$, which wouldn't give enough data to construct a decent model.

# 3. Model Based Approach

The parameters seem to be stable over all thresholds, therefore the earlier choice of $u=30$ is still reasonable.

# 4. ML GPD Estimates
```{r pressure, echo=FALSE}
rain$models$fit1$results
```
# 5. Fit GPD with R

```{r pressure, echo=FALSE}
fevd(x=value,data=rain$data, threshold=30,type="GP")
```
Results are the same with both approaches.

# 6. ML Covariance-matrix
```{r pressure, echo=FALSE}
parcov.fevd(rain$models$fit1)
```
# 7. Inverse Fisher Information Matrix
```{r pressure, echo=FALSE}
solve(rain$models$fit1$results$hessian)
```

Results are confirmed.

# 8. CI for GPD Model using Normal Approximation
      95% lower CI Estimate 95% upper CI
scale   5.56158139 7.440252    9.3189230
shape  -0.01385379 0.184498    0.3828497

[1] "Normal Approx."

[1] "100-year return level: 106.342"

[1] "95% Confidence Interval: (65.6224, 147.0622)"

# 9. Double Check Result
```{r}
ci(rain$models$fit1,type="parameter")
```


# 10. Profile Likelihood Approach for CI
[1] "scale: 7.44"

[1] "95% Confidence Interval: (5.9302, 9.5062)"

[1] "shape: 0.184"

[1] "95% Confidence Interval: (0.0139, 0.4133)"

[1] "100-year return level: 106.342"

[1] "95% Confidence Interval: (81.7012, 184.8934)"

# 11. Comparision
```{r}
ci(rain$models$fit1,type="parameter",method="proflik",which.par=2,xrange=c(-0.5,1),nint=100)
```

# 12. ML for 100 and 10 Year Returns
```{r}
c_u = 152/16531
pars = rain$models$fit1$results$par
x10 = 30 + (pars[1]/pars[2])*((10*c_u^pars[2])-1)
x100 = 30 + (pars[1]/pars[2])*((100*c_u^pars[2])-1)

```

# 13. Delta Method CI
[1] "Normal Approx."

[1] "100-year return level: 106.342"

[1] "95% Confidence Interval: (65.6224, 147.0622)"


[1] "Normal Approx."

[1] "10-year return level: 65.961"

[1] "95% Confidence Interval: (55.893, 76.0299)"

# 14. Profile Likelihood for 10 and 100 Year Returns

[1] "10-year return level: 65.961"

[1] "95% Confidence Interval: (58.6417, 81.1786)"

[1] "100-year return level: 106.342"

[1] "95% Confidence Interval: (80.973, 184.582)"

# 15. Diagonstics for GPD

Not the best plots

# 16. ML estimate of $\sigma$

# 17. Double Check
```{r}
fevd(x=value,data=rain$data,threshold = 30,type = "Exponential")

```
# 18. CI for $\sigma$ under H0

# 19. Likelihood Ratio Test

# 20. QQ-plots


